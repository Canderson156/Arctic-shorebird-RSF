"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
View(landcover_classes)
View(prop_lc)
View(landcover_classes)
str(landcover)
View(names)
View(plot_lc2)
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 1:15,
lc_class = c(
"0_missing data"
"1_tussock graminoid tundra",
"2_wet sedge",
"3_moist to dry non-tussock graminoid / dwarf shrub tundra",
"4_dry graminoid prostrate dwarf shrub tundra",
"5_low shrub",
"6_tall shrub",
"7_prostrate dwarf shrub",
"8_sparsely vegetated bedrock",
"9_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 1:15,
lc_class = c(
"0_missing data",
"1_tussock graminoid tundra",
"2_wet sedge",
"3_moist to dry non-tussock graminoid / dwarf shrub tundra",
"4_dry graminoid prostrate dwarf shrub tundra",
"5_low shrub",
"6_tall shrub",
"7_prostrate dwarf shrub",
"8_sparsely vegetated bedrock",
"9_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 1:15,
lc_class = c(
"0_missing data",
"1_tussock graminoid tundra",
"2_wet sedge",
"3_moist to dry non-tussock graminoid / dwarf shrub tundra",
"4_dry graminoid prostrate dwarf shrub tundra",
"5_low shrub",
"6_tall shrub",
"7_prostrate dwarf shrub",
"8_sparsely vegetated bedrock",
"9_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"missing data",
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 0:15,
lc_class = c(
"0_missing data",
"1_tussock graminoid tundra",
"2_wet sedge",
"3_moist to dry non-tussock graminoid / dwarf shrub tundra",
"4_dry graminoid prostrate dwarf shrub tundra",
"5_low shrub",
"6_tall shrub",
"7_prostrate dwarf shrub",
"8_sparsely vegetated bedrock",
"9_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"missing data",
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
n_unique(prop_lc$plot)
View(prop_lc)
View(names)
prop_lc_wide <- prop_lc %>%
select(-lc_group, -lc_code) %>%
spread(lc_class, prop, fill = 0)
View(prop_lc_wide)
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 0:15,
lc_class = c(
"00_missing data",
"01_tussock graminoid tundra",
"02_wet sedge",
"03_moist to dry non-tussock graminoid / dwarf shrub tundra",
"04_dry graminoid prostrate dwarf shrub tundra",
"05_low shrub",
"06_tall shrub",
"07_prostrate dwarf shrub",
"08_sparsely vegetated bedrock",
"09_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"missing data",
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
#wide version
prop_lc_wide <- prop_lc %>%
select(-lc_group, -lc_code) %>%
spread(lc_class, prop, fill = 0)
View(prop_lc_wide)
?pca
View(prop_lc)
?summarize
View(prop_lc)
group <- prop_lc %>%
group_by(plot, lc_group) %>%
summarize(sum_group = sum(prop))
View(group)
group <- prop_lc %>%
group_by(plot, lc_group) %>%
summarize(sum_group = sum(prop)) %>%
mutate(lc_group = paste("group", lc_group, sep = "_"))
View(group)
group <- prop_lc %>%
group_by(plot, lc_group) %>%
summarize(sum_group = sum(prop)) %>%
mutate(lc_group = paste("group", lc_group, sep = "_")) %>%
spread(lc_group, sum_group)
View(group)
group <- prop_lc %>%
group_by(plot, lc_group) %>%
summarize(sum_group = sum(prop)) %>%
mutate(lc_group = paste("group", lc_group, sep = "_")) %>%
spread(lc_group, sum_group, fill = 0)
View(group)
View(all_polygons_df)
View(prop_lc_wide)
View(prism)
##### LOAD PACKAGES
library(raster)
library(ggplot2)
library(lme4)
library(lubridate)
library(reshape2)
library(beepr)
library(rgdal)
library(sp)
library(MASS)
library(rgeos)
library(maptools)
library(rgdal)
library(reshape)
#library(SDMTools)
#library(velox)
library(gdalUtils)
library(sf)
library(plyr)
library(dplyr)
library(ggplot2)
#library(corrplot)
#library(scales)
library(tidyverse)
library(units)
#library(stringi)
#library(lwgeom)
library(measurements)
library(miceadds)
library(plotKML)
library(tmaptools)
library(GGally)
#-- Conflicts ------------------------------------------ tidyverse_conflicts() --
# x lubridate::as.difftime() masks base::as.difftime()
# x lubridate::date()        masks base::date()
# x tidyr::expand()          masks Matrix::expand()
# x tidyr::extract()         masks raster::extract()
# x dplyr::filter()          masks stats::filter()
# x lubridate::intersect()   masks raster::intersect(), base::intersect()
# x dplyr::lag()             masks stats::lag()
# x dplyr::select()          masks raster::select()
# x lubridate::setdiff()     masks base::setdiff()
# x lubridate::union()       masks raster::union(), base::union()
#### settings
options(scipen=999) #disable scientific notation
options(stringsAsFactors = FALSE) #disable strings as factors
#### source custom functions
source.all("functions/")
##### OBJECTS SPECIFIC TO THIS PROJECT
## Coordinate reference systems
#NPLAEA <-  CRS("+init=EPSG:3573")
#AEA <- CRS("+proj=aea +lat_1=50 +lat_2=70 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
LCC <- CRS("+proj=lcc +lat_1=49 +lat_2=77 +lat_0=0 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs")
WGS84 <- CRS("+init=EPSG:4326")
NAD83 <- CRS("+init=EPSG:4269")
#### Read in raw data
# Read in full PRISM dataset
bigdata_raw <-read.csv("data/PRISM/PRISM 1994 to 2019_20191210_CAedits_20200529.csv"
, stringsAsFactors = FALSE, na.strings=c("", "NA"))
#extract environmental variables for surveyed plots
### some inconsitiencies in this code:
#why do the avg temps end up with 8 plots with "NaN", but the annual ones don't?
#Why does the finaly version of all_polygons_df have so many duplicated rows, which I got rid of using distinct()?
#I had figured this out and now I don't recall the answer
filelist1 <- list.files("data/climate/WorldClim/raw_1_year/LCC/June/", full.names = TRUE)
temp_rasters <- stack(filelist1)
temp_30_avg_june <- raster("data/climate/WorldClim/temp_30_avg_june_LCC.tif")
temp_30_avg_july <- raster("data/climate/WorldClim/temp_30_avg_july_LCC.tif")
landcover <- raster("data/landcover/Northern_Land_Cover_2000/landcover_mosaic_lcc.tif")
all_polygons <- readRDS("Robjects/all_polygons.RDS")
included_surveys <- readRDS("Robjects/included_surveys.RDS")
prism <- readRDS("Robjects/prism.RDS")
plot_lc2 <- readRDS("Robjects/plot_lc2.RDS")
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 0:15,
lc_class = c(
"00_missing data",
"01_tussock graminoid tundra",
"02_wet sedge",
"03_moist to dry non-tussock graminoid / dwarf shrub tundra",
"04_dry graminoid prostrate dwarf shrub tundra",
"05_low shrub",
"06_tall shrub",
"07_prostrate dwarf shrub",
"08_sparsely vegetated bedrock",
"09_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"missing data",
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
###some how I'm losing 49 plots here
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$plot <- as.character(prop_lc$plot)
prop_lc_wide <- prop_lc %>%
select(-lc_group, -lc_code) %>%
spread(lc_class, prop, fill = 0)
View(prop_lc_wide)
table(prop_lc_wide$`00_missing data` > 0.1)
table(prop_lc_wide$`00_missing data` > 0.05)
table(prop_lc_wide$`00_missing data` > 0.1)
table(prop_lc_wide$`00_missing data` > 0.01)
table(prop_lc_wide$`14_shadow` > 0.01)
table(prop_lc_wide$`15_water` > 0.01)
table(prop_lc_wide$`15_water` > 0.10)
table(prop_lc_wide$`13_ice / snow` > 0.05)
group <- prop_lc %>%
group_by(plot, lc_group) %>%
summarize(sum_group = sum(prop)) %>%
mutate(lc_group = paste("group", lc_group, sep = "_")) %>%
spread(lc_group, sum_group, fill = 0)
View(group)
all_polygons_df <- all_polygons@data
all_polygons_df <- readRDS("Robjects/all_polygons_df.RDS")
View(all_polygons_df)
View(all_polygons_df)
all_polygons_df <- all_polygons_df[,1:5]
View(all_polygons_df)
all_polygons_df <- merge(all_polygons_df <- all_polygons@data, prop_lc_wide)
all_polygons_df <- merge(all_polygons_df, prop_lc_wide)
all_polygons_df <- readRDS("Robjects/all_polygons_df.RDS")
m <- merge(prop_lc_wide, group)
View(m)
View(all_polygons_df)
plot_lc2 <- readRDS("Robjects/plot_lc2.RDS")
prop_lc <- plot_lc2 %>%
group_by(ID, landcover_mosaic_lcc) %>%
dplyr::summarize(prop = sum(weight))
names <- data.frame(Plot = all_polygons$Plot, ID = 1:length(all_polygons$Plot))
prop_lc <- merge(prop_lc, names)
prop_lc <- prop_lc %>%
ungroup %>%
dplyr::select(-ID) %>%
dplyr::rename(lc_code = landcover_mosaic_lcc)
landcover_classes <- data.frame(lc_code = 0:15,
lc_class = c(
"00_missing data",
"01_tussock graminoid tundra",
"02_wet sedge",
"03_moist to dry non-tussock graminoid / dwarf shrub tundra",
"04_dry graminoid prostrate dwarf shrub tundra",
"05_low shrub",
"06_tall shrub",
"07_prostrate dwarf shrub",
"08_sparsely vegetated bedrock",
"09_sparsely vegetated till-colluvium",
"10_bare soil with cryptogam crust - frost boils",
"11_wetlands",
"12_barren",
"13_ice / snow",
"14_shadow",
"15_water"),
lc_group = c(
"missing data",
"graminoid",
"graminoid",
"graminoid",
"graminoid",
"shrub",
"shrub",
"shrub",
"sparsely vegetated",
"sparsely vegetated",
"sparsely vegetated",
"wetland",
"barren",
"ice / snow",
"shadow",
"water"))
prop_lc <- merge(prop_lc, landcover_classes) %>%
distinct()
prop_lc$Plot <- as.character(prop_lc$Plot)
prop_lc_wide <- prop_lc %>%
select(-lc_group, -lc_code) %>%
spread(lc_class, prop, fill = 0)
group <- prop_lc %>%
group_by(Plot, lc_group) %>%
summarize(sum_group = sum(prop)) %>%
mutate(lc_group = paste("group", lc_group, sep = "_")) %>%
spread(lc_group, sum_group, fill = 0)
m <- merge(prop_lc_wide, group)
View(m)
View(all_polygons_df)
all_polygons_df <- merge(all_polygons_df, prop_lc_wide, by = "Plot")
View(all_polygons_df)
View(all_polygons_df)
#saveRDS
saveRDS(all_polygons_df, "Robjects/all_polygons_df.RDS")
